{% load i18n static %}<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta content="text/html; charset=utf-8" http-equiv="content-type" />
        <meta content="qa" name="description" />
        <title>QA</title>
        <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" rel="stylesheet">
        <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'frontend/css/jquery.jsonview.css' %}">
        <!--link rel="stylesheet" type="text/css" href="{% static 'frontend/css/style.css' %}"-->
        <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
        <script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
        <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="{% static 'frontend/js/jquery.jsonview.js' %}"></script>
        <!--script src="{% static 'frontend/js/index.js' %}"></script-->
        <script>
            var api_query = "{% url 'backend:query' %}";
            var api_tips = "{% url 'backend:tips' %}";
        </script>
        <script>
$(document).ready(init);

var backend_status = null;

function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

function init() {
    $('#input-query').bind('keydown', function(e) {
        var event = e || window.event;
        var code = event.keyCode || event.which || event.charCode;
        if (code == '\n'.charCodeAt(0) || code == '\r'.charCodeAt(0)) {
            e.preventDefault();
            $("#button-query").click();
        }
    }).focus();
    $('#button-query').click(function() {
        $.ajax({
            url: api_query,
            method: 'POST',
            data: {
                csrfmiddlewaretoken: $.cookie('csrftoken'),
                status: backend_status,
                text: $('#input-query')[0].value,
            },
            success: function(data) {
                if (data.error) {
                    alert(data.msg);
                    return;
                }
                console.log(data.msg);
                backend_status = data.msg.status;
                var wrapper = $('<div></div>');
                wrapper.addClass('view-query');
                $.map(data.msg.products, function(p) {
                    var div = $('.templates .computer-summary').clone();
                    div.find('#image').attr('src', p['img']);
                    div.find('#title').text(p['型号']);
                    div.find('#title').attr('href', p['link']);
                    div.find('#price').text(p['price']);
                    div.find('#cpu').text(p['CPU型号']);
                    div.find('#memory').text(p['内存容量']);
                    div.find('#disk').text(p['硬盘容量']);
                    div.find('#screen').text(p['屏幕尺寸']);
                    div.find('#cpu_freq').text(p['CPU主频']);
                    div.find('#gpu').text(p['显卡芯片']);
                    div.find('#gpu_size').text(p['显存容量']);
                    div.find('#market_time').text(p['上市时间']);
                    div.find('#weight').text(p['笔记本重量']);
                    wrapper.append(div);
                });
                var div = $('.templates .message-show').clone();
                div.find('#content').text(data.msg.message);
                wrapper.append(div);
                var div = $('.templates .debug-show').clone();
                var debug_json = JSON.parse(backend_status);
                delete debug_json.last_products;
                div.JSONView(debug_json, { collapsed: false });
                wrapper.append(div);
                $('.view').empty().append(wrapper);
            },
            error: function(e) {
                var wrapper = $('<div></div>');
                wrapper.text('ajax failed');
                $('.view').empty().append(wrapper);
            }
        });
    });
    $('#button-tips').click(function() {
        $.ajax({
            url: api_tips,
            method: 'POST',
            data: {
                csrfmiddlewaretoken: $.cookie('csrftoken'),
                status: backend_status,
            },
            success: function(data) {
                if (data.error) {
                    alert(data.msg);
                    return;
                }
                backend_status = data.status;
                var div = $('<div></div>');
                var p = $('<p></p>');
                p.text(JSON.stringify(data.msg));
                div.addClass('view-tips');
                div.append(p);
                $('.view').empty().append(div);
            },
            error: function(e) {
                var wrapper = $('<div></div>');
                wrapper.text('ajax failed');
                $('.view').empty().append(wrapper);
            }
        });
    });
}
        </script>
        <style>

        </style>
    </head>
    <body>
        {% csrf_token %}
        <div class="container" align="center">
            <div class="view" style="height: 600px; overflow: auto;"></div>
            <div>
                <input id="input-query" style="width: 600px;"/>
                <button id="button-query">Submit</button>
                <button id="button-tips">Tips</button>
            </div>
        </div>
        <div class="templates" hidden>
            <div class="computer-summary">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-2">
                            <img id="image" style="width: 80%"/>
                        </div>
                        <div class="col-sm-10">
                            <div class="row">
                                <div class="col-sm-9"><a id="title" target="_blank">名称</a></div>
                                <div class="col-sm-3" style="color: red"><span id="price">价格</span> 元</div>
                            </div>
                            <div class="row">
                                <div class="col-sm-3" id="cpu">CPU</div>
                                <div class="col-sm-3" id="memory">内存</div>
                                <div class="col-sm-3" id="disk">硬盘</div>
                                <div class="col-sm-3" id="screen">屏幕</div>
                            </div>
                            <div class="row">
                                <div class="col-sm-3" id="cpu_freq">CPU频率</div>
                                <div class="col-sm-3"><span id="gpu"></span> (<span id="gpu_size"></span>)</div>
                                <div class="col-sm-3" id="market_time">上市时间</div>
                                <div class="col-sm-3" id="weight">重量</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="message-show">
                <p id="content"></p>
            </div>
            <div class="debug-show" align="left">
            </div>
        </div>
    </body>
</html>
